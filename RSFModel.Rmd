---
title: "RSFModel"
author: "Kelly Kapsar"
date: "8/19/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Import libraries. 

```{r message=FALSE, warning=FALSE}
library(tidyr)
library(dplyr)
library(sf)
library(raster)
library(ggplot2)
library(scales)
library(ggmap)
library(leaflet)
library(ggplot2)
library(GGally)

opar <- par()      # make a copy of current graphical parameters
```

Study area boundaries. 

```{r study area warning=FALSE}
# Projection information for WGS84/UTM Zone 5N (EPSG:32605)
prj <- 32605

# Create study area polygon
coords <- data.frame(lat=c(56, 62, 62, 56, 56), lon=c(-155, -155, -143, -143, -155), id="study")
study <- coords %>% 
         st_as_sf(coords = c("lon", "lat"), crs=4326) %>% 
         group_by(id) %>% 
         summarize(geometry = st_combine(geometry)) %>%  
         st_cast("POLYGON") %>% 
         st_transform(prj)
# st_write(study, "../Data_Raw/studyarea.shp")

basemap <- read_sf("../Data_Raw/BBmap.shp") %>% st_transform(prj) %>%  st_buffer(0)

# Crop basemap to buffered extent of study area 
study.buff <- st_buffer(study, 100000) # Buffer study area by 100 km
basemap.crop <- st_crop(basemap, study.buff)

# Map of study area 
ggplot() +
  geom_sf(data=basemap.crop, fill="gray", color="black", lwd=0.5) +
  geom_sf(data=study, fill=NA, color="red")

# Get latlong coordinates for study area for use in downloading other data sets
studylatlon <- study %>% st_transform(4269) %>% st_bbox()

```

Pull in SSL data. 

```{r}
ssl <- readRDS("../Data_Processed/SSL_UsedAndAvail_WithCovars.rds") 
usedbuff <- readRDS("../Data_Processed/watersealibuffs.rds")

```


```{r covariate plots}

# used vs. available for all ind'ls grouped
boxplot(Bathymetry ~ Used, data = ssl, ylab=NA, main = "Depth (m)")
boxplot(DistLand ~ Used, data = ssl, ylab=NA, main = "Distance to Land (km)")
boxplot(Dist500m ~ Used, data = ssl, ylab=NA, main = "Distance to Shelf Break (km)")
boxplot(slope ~ Used, data = ssl, ylab=NA, main = "Slope (degrees)")
boxplot(ssh ~ Used, data = ssl, ylab=NA, main = "Sea Surface Height (m)")
boxplot(eke ~ Used, data = ssl, ylab=NA, main = "Eddy Kinetic Energy (m^2/s^2)")
boxplot(wind ~ Used, data = ssl, ylab=NA, main = "Wind speed (m/s")
boxplot(fish ~ Used, data = ssl, ylab=NA, main = "Fishing (km)")
boxplot(ship ~ Used, data = ssl, ylab=NA, main = "Other Shipping (km)")
boxplot(sst ~ Used, data = ssl, ylab=NA, main = "Sea Surface Temperature (C)")

# Individual differences in use 
boxplot(Bathymetry ~ DeployID, data = subset(ssl, Used == "Used"))
boxplot(DistLand ~ DeployID, data = subset(ssl, Used == "Used"))
boxplot(Dist500m ~ DeployID, data = subset(ssl, Used == "Used"))
boxplot(slope ~ DeployID, data = subset(ssl, Used == "Used"))
boxplot(ssh ~ DeployID, data = subset(ssl, Used == "Used"))
boxplot(eke ~ DeployID, data = subset(ssl, Used == "Used"))
boxplot(wind ~ DeployID, data = subset(ssl, Used == "Used"))
boxplot(fish ~ DeployID, data = subset(ssl, Used == "Used"))
boxplot(ship ~ DeployID, data = subset(ssl, Used == "Used"))
boxplot(sst ~ DeployID, data = subset(ssl, Used == "Used"))

# Correlations between covariates 
ssl %>% dplyr::select(Bathymetry, DistLand, Dist500m, slope, ssh, eke, wind, fish, ship, sst) %>% ggcorr(label=T)

```

```{r centering variables}

ssl$Bathymetry.ctd <- ssl$Bathymetry - mean(ssl$Bathymetry)
ssl$DistLand.ctd <- ssl$DistLand - mean(ssl$DistLand)
ssl$Dist500m.ctd <- ssl$Dist500m - mean(ssl$Dist500m)
ssl$slope.ctd <- ssl$slope - mean(ssl$slope)
ssl$ssh.ctd <- ssl$ssh - mean(ssl$ssh)
ssl$eke.ctd <- ssl$eke - mean(ssl$eke)
ssl$wind.ctd <- ssl$wind - mean(ssl$wind)
ssl$fish.ctd <- ssl$fish - mean(ssl$fish)
ssl$ship.ctd <- ssl$ship - mean(ssl$ship)
ssl$sst.ctd <- ssl$sst - mean(ssl$sst)




```

